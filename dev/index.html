<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generic Coordinate Transformation Library (PROJ) C API • libproj</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Generic Coordinate Transformation Library (PROJ) C API">
<meta property="og:description" content="Provides a PROJ &lt;https://proj.org&gt; C API that can be 
  used to write high-performance C and C++ coordinate transformation
  operations using R as an interface. This package contains an internal 
  version of the PROJ library to guarantee the best possible 
  consistency on multiple platforms, and to provide a means by which
  PROJ can be used on platforms where it may be impractical
  or impossible to install a binary version of the library.">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">libproj</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">8.2.0-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/paleolimbot/libproj/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="libproj">libproj<a class="anchor" aria-label="anchor" href="#libproj"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of libproj is to provide access to the <a href="https://proj.org" class="external-link">PROJ</a> C API for high-performance geometry operations within the R package framework. This package contains a copy of the PROJ library, modified slightly to eliminate errors on all the platforms checked by CRAN and GitHub actions. This means you don’t have to install anything (other than the package) to take advantage of PROJ functions in R. It also means you don’t need a configure script if you’re writing a package that needs PROJ functionality (just <code>LinkingTo: libproj</code>).</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of libproj from <a href="https://cran.r-project.org/" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"libproj"</span><span class="op">)</span></code></pre></div>
<p>To install a binary on supported Linux platforms, you can use RStudio Package Manager’s public instance.</p>
<p>You can install the development version from <a href="https://r-universe.dev/" class="external-link">R Universe</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"libproj"</span>, repos <span class="op">=</span> <span class="st">"https://paleolimbot.r-universe.dev"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h2>
<p>The libproj package provides a configuration that is likely to work on all systems by default.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/libproj/" class="external-link">libproj</a></span><span class="op">)</span>
<span class="fu"><a href="reference/libproj_version.html">libproj_configuration</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; $db_path</span>
<span class="co">#&gt; [1] "/Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/library/libproj/proj/proj.db"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $search_path</span>
<span class="co">#&gt; [1] "/Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/library/libproj/proj"</span>
<span class="co">#&gt; [2] "/Users/deweydunnington/Library/Application Support/R-libproj/data"                </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $network_endpoint</span>
<span class="co">#&gt; [1] "https://cdn.proj.org"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $log_level</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ca_bundle_path</span>
<span class="co">#&gt; [1] NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $network_enabled</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>You probably want to install the <a href="https://github.com/OSGeo/PROJ-data" class="external-link">PROJ-data files</a> or turn on network access (by setting <code>options(libproj.network_enabled = TRUE)</code> in your .Rprofile) to ensure that datum transforms are handled correctly. The preferred approach is to install all the data files (~600 MB).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/libproj_install_proj_data.html">libproj_install_proj_data</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>Checking <span class="cf">for</span> latest PROJ<span class="op">-</span>data package at https<span class="op">:</span><span class="er">//</span>github.com<span class="op">/</span>OSGeo<span class="op">/</span>PROJ<span class="op">-</span>data<span class="op">/</span>releases<span class="op">/</span>latest</span>
<span id="cb5-2"><a href="#cb5-2"></a>Downloading <span class="st">'https://github.com/OSGeo/PROJ-data/releases/download/1.6.0/proj-data-1.6.zip'</span> (<span class="dv">558</span> MB)</span>
<span id="cb5-3"><a href="#cb5-3"></a>trying URL <span class="st">'https://github.com/OSGeo/PROJ-data/releases/download/1.6.0/proj-data-1.6.zip'</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>Content type <span class="st">'application/octet-stream'</span> length <span class="dv">585582140</span> <span class="kw">bytes</span> (<span class="fl">558.5</span> MB)</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="op">==</span><span class="er">================================================</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>downloaded <span class="fl">558.5</span> MB</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>Extracting <span class="st">'/var/folders/bq/2rcjstv90nx1_wrt8d3gqw6m0000gn/T//RtmplU9vQO/filed4072e1fa820.zip'</span> to <span class="st">'/Users/dewey/Library/Application Support/R-libproj/data'</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>Saving a record of the install to <span class="st">'/Users/dewey/Library/Application Support/R-libproj/data/.libproj_install_proj_data'</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>Done.</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This package only exists for its exported C API. You can use it interactively (if using Rcpp use <code>// [[Rcpp::depends(libproj)]]</code>; if using cpp11 use <code>[[cpp11::linking_to(libproj)]]</code> to decorate at least one function) or by adding <code>libproj</code> to the <code>LinkingTo</code> field of a dependency package.</p>
<p>An example using <a href="https://cpp11.r-lib.org" class="external-link">cpp11</a>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1"></a><span class="pp">#include </span><span class="im">&lt;cpp11.hpp&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">using</span> <span class="kw">namespace</span> cpp11;</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">// needed in every file that uses proj_*() functions</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="pp">#include </span><span class="im">"libproj.h"</span></span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">// needed exactly once in your package or Rcpp script</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">// contains all the function pointers and the</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">// implementation of the function to initialize them</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">// (`libproj_init_api()`)</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="pp">#include </span><span class="im">"libproj.c"</span></span>
<span id="cb6-12"><a href="#cb6-12"></a></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">// this function needs to be called once before any proj_*() functions</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">// are called (e.g., in .onLoad() for your package)</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>[[<span class="at">cpp11</span>::<span class="at">linking_to</span>(<span class="at">libproj</span>)]]</span>
<span id="cb6-16"><a href="#cb6-16"></a>[[<span class="at">cpp11</span>::<span class="at">register</span>]]</span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="dt">void</span> cpp_libproj_init_api() {</span>
<span id="cb6-18"><a href="#cb6-18"></a>  libproj_init_api();</span>
<span id="cb6-19"><a href="#cb6-19"></a>}</span>
<span id="cb6-20"><a href="#cb6-20"></a></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">// regular C or C++ code that uses proj_()* functions!</span></span>
<span id="cb6-22"><a href="#cb6-22"></a>[[<span class="at">cpp11</span>::<span class="at">register</span>]]</span>
<span id="cb6-23"><a href="#cb6-23"></a>list proj_coords(list xy, <span class="bu">std::</span>string from, <span class="bu">std::</span>string to) {</span>
<span id="cb6-24"><a href="#cb6-24"></a>  doubles x = xy[<span class="dv">0</span>];</span>
<span id="cb6-25"><a href="#cb6-25"></a>  doubles y = xy[<span class="dv">1</span>];</span>
<span id="cb6-26"><a href="#cb6-26"></a>  </span>
<span id="cb6-27"><a href="#cb6-27"></a>  PJ_CONTEXT* context = PJ_DEFAULT_CTX;</span>
<span id="cb6-28"><a href="#cb6-28"></a>  </span>
<span id="cb6-29"><a href="#cb6-29"></a>  PJ* trans = proj_create_crs_to_crs(context, from.c_str(), to.c_str(), NULL);</span>
<span id="cb6-30"><a href="#cb6-30"></a>  <span class="cf">if</span> (trans == NULL) {</span>
<span id="cb6-31"><a href="#cb6-31"></a>    <span class="dt">int</span> error_code = proj_context_errno(context);</span>
<span id="cb6-32"><a href="#cb6-32"></a>    stop(<span class="st">"Error creating transform: </span><span class="sc">%s</span><span class="st">"</span>, proj_context_errno_string(context, error_code));</span>
<span id="cb6-33"><a href="#cb6-33"></a>  }</span>
<span id="cb6-34"><a href="#cb6-34"></a>  </span>
<span id="cb6-35"><a href="#cb6-35"></a>  writable::doubles xout(x);</span>
<span id="cb6-36"><a href="#cb6-36"></a>  writable::doubles yout(y);</span>
<span id="cb6-37"><a href="#cb6-37"></a>  <span class="dt">size_t</span> stride = <span class="kw">sizeof</span>(<span class="dt">double</span>);</span>
<span id="cb6-38"><a href="#cb6-38"></a>  </span>
<span id="cb6-39"><a href="#cb6-39"></a>  proj_trans_generic(</span>
<span id="cb6-40"><a href="#cb6-40"></a>    trans, PJ_FWD,</span>
<span id="cb6-41"><a href="#cb6-41"></a>    REAL(xout), stride, xout.size(),</span>
<span id="cb6-42"><a href="#cb6-42"></a>    REAL(yout), stride, yout.size(),</span>
<span id="cb6-43"><a href="#cb6-43"></a>    <span class="kw">nullptr</span>, stride, <span class="dv">0</span>,</span>
<span id="cb6-44"><a href="#cb6-44"></a>    <span class="kw">nullptr</span>, stride, <span class="dv">0</span></span>
<span id="cb6-45"><a href="#cb6-45"></a>  );</span>
<span id="cb6-46"><a href="#cb6-46"></a>  </span>
<span id="cb6-47"><a href="#cb6-47"></a>  <span class="dt">int</span> error_code = proj_errno(trans);</span>
<span id="cb6-48"><a href="#cb6-48"></a>  proj_destroy(trans);</span>
<span id="cb6-49"><a href="#cb6-49"></a>  </span>
<span id="cb6-50"><a href="#cb6-50"></a>  <span class="cf">if</span> (error_code != <span class="dv">0</span>) {</span>
<span id="cb6-51"><a href="#cb6-51"></a>    stop(<span class="st">"Error transforming coords: </span><span class="sc">%s</span><span class="st">"</span>, proj_context_errno_string(context, error_code));</span>
<span id="cb6-52"><a href="#cb6-52"></a>  }</span>
<span id="cb6-53"><a href="#cb6-53"></a>  </span>
<span id="cb6-54"><a href="#cb6-54"></a>  writable::list out = {xout, yout};</span>
<span id="cb6-55"><a href="#cb6-55"></a>  out.names() = {<span class="st">"x"</span>, <span class="st">"y"</span>};</span>
<span id="cb6-56"><a href="#cb6-56"></a>  <span class="cf">return</span> out;</span>
<span id="cb6-57"><a href="#cb6-57"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">cpp_libproj_init_api</span><span class="op">(</span><span class="op">)</span>
<span class="fu">proj_coords</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">-</span><span class="fl">64</span>, <span class="fl">45</span><span class="op">)</span>, <span class="st">"+proj=longlat"</span>, <span class="st">"EPSG:32620"</span><span class="op">)</span>
<span class="co">#&gt; $x</span>
<span class="co">#&gt; [1] 421184.7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $y</span>
<span class="co">#&gt; [1] 4983437</span></code></pre></div>
<p>An example using <a href="https://cran.r-project.org/package=Rcpp" class="external-link">Rcpp</a>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">// [[Rcpp::depends(libproj)]]</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="pp">#include </span><span class="im">"libproj.h"</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="pp">#include </span><span class="im">"libproj.c"</span></span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="dt">void</span> cpp_libproj_init_api() {</span>
<span id="cb8-10"><a href="#cb8-10"></a>  libproj_init_api();</span>
<span id="cb8-11"><a href="#cb8-11"></a>}</span>
<span id="cb8-12"><a href="#cb8-12"></a></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>List proj_coords(List xy, <span class="bu">std::</span>string from, <span class="bu">std::</span>string to) {</span>
<span id="cb8-15"><a href="#cb8-15"></a>  NumericVector x = xy[<span class="dv">0</span>];</span>
<span id="cb8-16"><a href="#cb8-16"></a>  NumericVector y = xy[<span class="dv">1</span>];</span>
<span id="cb8-17"><a href="#cb8-17"></a>  </span>
<span id="cb8-18"><a href="#cb8-18"></a>  PJ_CONTEXT* context = PJ_DEFAULT_CTX;</span>
<span id="cb8-19"><a href="#cb8-19"></a>  </span>
<span id="cb8-20"><a href="#cb8-20"></a>  PJ* trans = proj_create_crs_to_crs(context, from.c_str(), to.c_str(), NULL);</span>
<span id="cb8-21"><a href="#cb8-21"></a>  <span class="cf">if</span> (trans == NULL) {</span>
<span id="cb8-22"><a href="#cb8-22"></a>    <span class="dt">int</span> errorCode = proj_context_errno(context);</span>
<span id="cb8-23"><a href="#cb8-23"></a>    <span class="bu">std::</span>stringstream err;</span>
<span id="cb8-24"><a href="#cb8-24"></a>    err &lt;&lt; <span class="st">"Error creating transform: "</span> &lt;&lt; proj_context_errno_string(context, errorCode);</span>
<span id="cb8-25"><a href="#cb8-25"></a>    stop(err.str());</span>
<span id="cb8-26"><a href="#cb8-26"></a>  }</span>
<span id="cb8-27"><a href="#cb8-27"></a>  </span>
<span id="cb8-28"><a href="#cb8-28"></a>  NumericVector xout = clone(x);</span>
<span id="cb8-29"><a href="#cb8-29"></a>  NumericVector yout = clone(y);</span>
<span id="cb8-30"><a href="#cb8-30"></a>  <span class="dt">size_t</span> stride = <span class="kw">sizeof</span>(<span class="dt">double</span>);</span>
<span id="cb8-31"><a href="#cb8-31"></a>  </span>
<span id="cb8-32"><a href="#cb8-32"></a>  proj_trans_generic(</span>
<span id="cb8-33"><a href="#cb8-33"></a>    trans, PJ_FWD,</span>
<span id="cb8-34"><a href="#cb8-34"></a>    &amp;(xout[<span class="dv">0</span>]), stride, xout.size(),</span>
<span id="cb8-35"><a href="#cb8-35"></a>    &amp;(yout[<span class="dv">0</span>]), stride, yout.size(),</span>
<span id="cb8-36"><a href="#cb8-36"></a>    <span class="kw">nullptr</span>, stride, <span class="dv">0</span>,</span>
<span id="cb8-37"><a href="#cb8-37"></a>    <span class="kw">nullptr</span>, stride, <span class="dv">0</span></span>
<span id="cb8-38"><a href="#cb8-38"></a>  );</span>
<span id="cb8-39"><a href="#cb8-39"></a>  </span>
<span id="cb8-40"><a href="#cb8-40"></a>  <span class="dt">int</span> errorCode = proj_errno(trans);</span>
<span id="cb8-41"><a href="#cb8-41"></a>  proj_destroy(trans);</span>
<span id="cb8-42"><a href="#cb8-42"></a>  </span>
<span id="cb8-43"><a href="#cb8-43"></a>  <span class="cf">if</span> (errorCode != <span class="dv">0</span>) {</span>
<span id="cb8-44"><a href="#cb8-44"></a>    <span class="bu">std::</span>stringstream err;</span>
<span id="cb8-45"><a href="#cb8-45"></a>    err &lt;&lt; <span class="st">"Error transforming coords: "</span> &lt;&lt; proj_context_errno_string(context, errorCode);</span>
<span id="cb8-46"><a href="#cb8-46"></a>    stop(err.str());</span>
<span id="cb8-47"><a href="#cb8-47"></a>  }</span>
<span id="cb8-48"><a href="#cb8-48"></a>  </span>
<span id="cb8-49"><a href="#cb8-49"></a>  <span class="cf">return</span> List::create(_[<span class="st">"x"</span>] = xout, _[<span class="st">"y"</span>]  = yout);</span>
<span id="cb8-50"><a href="#cb8-50"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">cpp_libproj_init_api</span><span class="op">(</span><span class="op">)</span>
<span class="fu">proj_coords</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">-</span><span class="fl">64</span>, <span class="fl">45</span><span class="op">)</span>, <span class="st">"+proj=longlat"</span>, <span class="st">"EPSG:32620"</span><span class="op">)</span>
<span class="co">#&gt; $x</span>
<span class="co">#&gt; [1] 421184.7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $y</span>
<span class="co">#&gt; [1] 4983437</span></code></pre></div>
<p>You can also link to libproj directly from C:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1"></a><span class="pp">#include </span><span class="im">&lt;R.h&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="pp">#include </span><span class="im">&lt;Rinternals.h&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="pp">#include </span><span class="im">"libproj.h"</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="pp">#include </span><span class="im">"libproj.c"</span></span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="pp">#include </span><span class="im">&lt;memory.h&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a>SEXP c_libproj_init_api() {</span>
<span id="cb10-10"><a href="#cb10-10"></a>  libproj_init_api();</span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="cf">return</span> R_NilValue;</span>
<span id="cb10-12"><a href="#cb10-12"></a>}</span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a>SEXP proj_coords(SEXP xy, SEXP from, SEXP to) {</span>
<span id="cb10-15"><a href="#cb10-15"></a>  R_xlen_t n = Rf_xlength(VECTOR_ELT(xy, <span class="dv">0</span>));</span>
<span id="cb10-16"><a href="#cb10-16"></a>  SEXP xout = PROTECT(Rf_allocVector(REALSXP, n));</span>
<span id="cb10-17"><a href="#cb10-17"></a>  SEXP yout = PROTECT(Rf_allocVector(REALSXP, n));</span>
<span id="cb10-18"><a href="#cb10-18"></a></span>
<span id="cb10-19"><a href="#cb10-19"></a>  <span class="dt">double</span>* x = REAL(VECTOR_ELT(xy, <span class="dv">0</span>));</span>
<span id="cb10-20"><a href="#cb10-20"></a>  <span class="dt">double</span>* y = REAL(VECTOR_ELT(xy, <span class="dv">1</span>));</span>
<span id="cb10-21"><a href="#cb10-21"></a></span>
<span id="cb10-22"><a href="#cb10-22"></a>  <span class="dt">const</span> <span class="dt">char</span>* from_c = Rf_translateCharUTF8(STRING_ELT(from, <span class="dv">0</span>));</span>
<span id="cb10-23"><a href="#cb10-23"></a>  <span class="dt">const</span> <span class="dt">char</span>* to_c = Rf_translateCharUTF8(STRING_ELT(to, <span class="dv">0</span>));</span>
<span id="cb10-24"><a href="#cb10-24"></a></span>
<span id="cb10-25"><a href="#cb10-25"></a>  PJ_CONTEXT* context = PJ_DEFAULT_CTX;</span>
<span id="cb10-26"><a href="#cb10-26"></a></span>
<span id="cb10-27"><a href="#cb10-27"></a>  PJ* trans = proj_create_crs_to_crs(context, from_c, to_c, NULL);</span>
<span id="cb10-28"><a href="#cb10-28"></a>  <span class="cf">if</span> (trans == NULL) {</span>
<span id="cb10-29"><a href="#cb10-29"></a>    <span class="dt">int</span> errorCode = proj_context_errno(context);</span>
<span id="cb10-30"><a href="#cb10-30"></a>    Rf_error(<span class="st">"Error creating transform: %s"</span>, proj_context_errno_string(context, errorCode));</span>
<span id="cb10-31"><a href="#cb10-31"></a>  }</span>
<span id="cb10-32"><a href="#cb10-32"></a></span>
<span id="cb10-33"><a href="#cb10-33"></a>  <span class="dt">size_t</span> stride = <span class="kw">sizeof</span>(<span class="dt">double</span>);</span>
<span id="cb10-34"><a href="#cb10-34"></a>  memcpy(REAL(xout), x, n * <span class="kw">sizeof</span>(<span class="dt">double</span>));</span>
<span id="cb10-35"><a href="#cb10-35"></a>  memcpy(REAL(yout), y, n * <span class="kw">sizeof</span>(<span class="dt">double</span>));</span>
<span id="cb10-36"><a href="#cb10-36"></a></span>
<span id="cb10-37"><a href="#cb10-37"></a>  proj_trans_generic(</span>
<span id="cb10-38"><a href="#cb10-38"></a>    trans, PJ_FWD,</span>
<span id="cb10-39"><a href="#cb10-39"></a>    REAL(xout), stride, n,</span>
<span id="cb10-40"><a href="#cb10-40"></a>    REAL(yout), stride, n,</span>
<span id="cb10-41"><a href="#cb10-41"></a>    NULL, stride, <span class="dv">0</span>,</span>
<span id="cb10-42"><a href="#cb10-42"></a>    NULL, stride, <span class="dv">0</span></span>
<span id="cb10-43"><a href="#cb10-43"></a>  );</span>
<span id="cb10-44"><a href="#cb10-44"></a></span>
<span id="cb10-45"><a href="#cb10-45"></a>  <span class="dt">int</span> errorCode = proj_errno(trans);</span>
<span id="cb10-46"><a href="#cb10-46"></a>  proj_destroy(trans);</span>
<span id="cb10-47"><a href="#cb10-47"></a></span>
<span id="cb10-48"><a href="#cb10-48"></a>  <span class="cf">if</span> (errorCode != <span class="dv">0</span>) {</span>
<span id="cb10-49"><a href="#cb10-49"></a>    Rf_error(<span class="st">"Error transforming coords: %s"</span>, proj_context_errno_string(context, errorCode));</span>
<span id="cb10-50"><a href="#cb10-50"></a>  }</span>
<span id="cb10-51"><a href="#cb10-51"></a></span>
<span id="cb10-52"><a href="#cb10-52"></a>  <span class="dt">const</span> <span class="dt">char</span>* names[] = {<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">""</span>};</span>
<span id="cb10-53"><a href="#cb10-53"></a>  SEXP out = PROTECT(Rf_mkNamed(VECSXP, names));</span>
<span id="cb10-54"><a href="#cb10-54"></a>  SET_VECTOR_ELT(out, <span class="dv">0</span>, xout);</span>
<span id="cb10-55"><a href="#cb10-55"></a>  SET_VECTOR_ELT(out, <span class="dv">1</span>, yout);</span>
<span id="cb10-56"><a href="#cb10-56"></a>  UNPROTECT(<span class="dv">3</span>);</span>
<span id="cb10-57"><a href="#cb10-57"></a>  </span>
<span id="cb10-58"><a href="#cb10-58"></a>  <span class="cf">return</span> out;</span>
<span id="cb10-59"><a href="#cb10-59"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/CallExternal.html" class="external-link">.Call</a></span><span class="op">(</span><span class="st">"c_libproj_init_api"</span><span class="op">)</span>
<span class="co">#&gt; NULL</span>
<span class="fu"><a href="https://rdrr.io/r/base/CallExternal.html" class="external-link">.Call</a></span><span class="op">(</span><span class="st">"proj_coords"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">-</span><span class="fl">64</span>, <span class="fl">45</span><span class="op">)</span>, <span class="st">"+proj=longlat"</span>, <span class="st">"EPSG:32620"</span><span class="op">)</span>
<span class="co">#&gt; $x</span>
<span class="co">#&gt; [1] 421184.7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $y</span>
<span class="co">#&gt; [1] 4983437</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=libproj" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/paleolimbot/libproj/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/paleolimbot/libproj/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing libproj</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Dewey Dunnington <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-9415-4582" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>PROJ authors <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Dewey Dunnington, PROJ authors.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
